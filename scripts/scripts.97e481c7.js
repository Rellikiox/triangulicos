function PoissonDiskSampler(a,b,c,d){this.width=a,this.height=b,this.minDistance=c,this.sampleFrequency=d,this.reset()}function Grid(a,b,c){this.width=a,this.height=b,this.minDistance=c,this.cellSize=this.minDistance/Math.SQRT2,this.pointSize=2,this.cellsWide=Math.ceil(this.width/this.cellSize),this.cellsHigh=Math.ceil(this.height/this.cellSize),this.grid=[];for(var d=0;d<this.cellsWide;d++){this.grid[d]=[];for(var e=0;e<this.cellsHigh;e++)this.grid[d][e]=null}}function RandomQueue(a){this.queue=a||new Array}function getRandomArbitrary(a,b){return Math.random()*(b-a)+a}function getRandomInt(a,b){return Math.floor(Math.random()*(b-a+1))+a}PoissonDiskSampler.prototype.reset=function(){this.grid=new Grid(this.width,this.height,this.minDistance),this.outputList=new Array,this.processingQueue=new RandomQueue},PoissonDiskSampler.prototype.sampleUntilSolution=function(){for(;this.sample(););return this.outputList},PoissonDiskSampler.prototype.sample=function(){if(0==this.outputList.length)return this.queueToAll(this.grid.randomPoint()),!0;var a=this.processingQueue.pop();if(null==a)return!1;for(var b=0;b<this.sampleFrequency;b++)samplePoint=this.grid.randomPointAround(a),this.grid.inNeighborhood(samplePoint)||this.queueToAll(samplePoint);return!0},PoissonDiskSampler.prototype.queueToAll=function(a){var b=this.grid.addPointToGrid(a,this.grid.pixelsToGridCoords(a));b&&(this.processingQueue.push(a),this.outputList.push(a))},Grid.prototype.pixelsToGridCoords=function(a){var b=Math.floor(a.x/this.cellSize),c=Math.floor(a.y/this.cellSize);return{x:b,y:c}},Grid.prototype.addPointToGrid=function(a,b){return b.x<0||b.x>this.grid.length-1?!1:b.y<0||b.y>this.grid[b.x].length-1?!1:(this.grid[b.x][b.y]=a,!0)},Grid.prototype.randomPoint=function(){return{x:getRandomArbitrary(0,this.width),y:getRandomArbitrary(0,this.height)}},Grid.prototype.randomPointAround=function(a){var b=Math.random(),c=Math.random(),d=this.minDistance*(b+1),e=2*Math.PI*c,f=a.x+d*Math.cos(e),g=a.y+d*Math.sin(e);return{x:f,y:g}},Grid.prototype.inNeighborhood=function(a){for(var b=(this.pixelsToGridCoords(a),this.cellsAroundPoint(a)),c=0;c<b.length;c++)if(null!=b[c]&&this.calcDistance(b[c],a)<this.minDistance)return!0;return!1},Grid.prototype.cellsAroundPoint=function(a){for(var b=this.pixelsToGridCoords(a),c=new Array,d=-2;3>d;d++){var e=b.x+d;0>e&&(e=0),e>this.grid.length-1&&(e=this.grid.length-1);for(var f=-2;3>f;f++){var g=b.y+f;0>g&&(g=0),g>this.grid[e].length-1&&(g=this.grid[e].length-1),c.push(this.grid[e][g])}}return c},Grid.prototype.calcDistance=function(a,b){return Math.sqrt((b.x-a.x)*(b.x-a.x)+(b.y-a.y)*(b.y-a.y))},RandomQueue.prototype.push=function(a){this.queue.push(a)},RandomQueue.prototype.pop=function(){for(randomIndex=getRandomInt(0,this.queue.length);void 0===this.queue[randomIndex];){for(var a=!0,b=0;b<this.queue.length;b++)void 0!==this.queue[b]&&(a=!1);if(a)return null;randomIndex=getRandomInt(0,this.queue.length)}return element=this.queue[randomIndex],this.queue.remove(randomIndex),element},Array.prototype.remove=function(a,b){var c=this.slice((b||a)+1||this.length);return this.length=0>a?this.length+a:a,this.push.apply(this,c)},angular.module("trianglesApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","colorpicker.module"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("trianglesApp").controller("MainCtrl",["$scope",function(a){a.topLeftColor="#FFFFFF",a.bottomRightColor="#000000",a.nPoints=150}]),angular.module("trianglesApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("trianglesApp").directive("paperCanvas",["Poissondisksampling","Triangulation",function(a,b){return{template:'<canvas id="canvas" width="900" height="700"></canvas>',restrict:"E",link:function(c){function d(){paper.install(window),paper.setup("canvas")}function e(a){new paper.Path.Circle({center:a,radius:1,fillColor:"black"})}function f(a,b,c){new paper.Path({segments:a,closed:b,fillColor:c})}function g(a,b){for(var c=a.length-1;c>=0;c--){var d=a[c],g=h(d);e(g);var i=b.getPixel(g);f(d,!0,i)}}function h(a){var b=a.reduce(function(a,b){return[a[0]+b[0],a[1]+b[1]]});return b[0]/=3,b[1]/=3,b}function i(a){var b=new paper.Path.Rectangle({topLeft:[0,0],bottomRight:[900,700],fillColor:{gradient:{stops:a},origin:[0,0],destination:[900,700]}});return b.rasterize()}function j(b){l=a.getPoints(1e3,800,b),console.log(l.length);for(var c=l.length-1;c>=0;c--)l[c].x-=50,l[c].y-=50}function k(a,c){var d=b.triangulate(a),e=i([c.topLeftColor,c.bottomRightColor]);g(d,e),paper.view.draw()}var l;d(),j(c.nPoints),c.$watchGroup(["topLeftColor","bottomRightColor"],function(a,b,c){void 0===l&&j(c.nPoints),k(l,c)}),c.$watch("nPoints",function(a,b,c){a!==b&&(j(c.nPoints),k(l,c))})}}}]),angular.module("trianglesApp").service("Poissondisksampling",function(){return{getPoints:function(a,b,c){var d=a*b,e=2,f=Math.sqrt(e*d/(c*Math.PI));return new PoissonDiskSampler(a,b,f,30).sampleUntilSolution()}}}),angular.module("trianglesApp").service("Triangulation",function(){var a={};return a.triangulate=function(b){if(!(b.length<=0)){if(!(b[0]instanceof Array)){for(var c=[],d=0;d<b.length;d++)c.push([b[d].x,b[d].y]);b=c}var e=Delaunay.triangulate(b);return a._pointsToTriangles(e,b)}},a._pointsToTriangles=function(a,b){for(var c=[],d=a.length-1;d>=0;)c.push([b[a[d--]],b[a[d--]],b[a[d--]]]);return c},a}),angular.module("trianglesApp").directive("colorPicker",function(){return{template:"<div></div>",restrict:"E",link:function(a,b){b.text("this is the colorPicker directive")}}});